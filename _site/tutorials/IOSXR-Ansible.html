

<!doctype html>
<html lang="en" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>            Using Ansible with IOS-XR 6.1.1      IOS XR Application Hosting @xrdocs      </title>







<meta property="og:locale" content="en-US">
<meta property="og:site_name" content="IOS XR Application Hosting @xrdocs">
<meta property="og:title" content="Using Ansible with IOS-XR 6.1.1">


  <link rel="canonical" href="https://xrdocs.io/application-hosting/tutorials/IOSXR-Ansible">
  <meta property="og:url" content="https://xrdocs.io/application-hosting/tutorials/IOSXR-Ansible">



  <meta property="og:description" content="Getting started with IOSXR and Ansible playbooks">



  <meta name="twitter:site" content="@xrdocs">
  <meta name="twitter:title" content="Using Ansible with IOS-XR 6.1.1">
  <meta name="twitter:description" content="Getting started with IOSXR and Ansible playbooks">
  <meta name="twitter:url" content="https://xrdocs.io/tutorials/IOSXR-Ansible">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="https://xrdocs.io/application-hosting/images/app-hosting-xrdocs.jpg">
    
  

  
    <meta name="twitter:creator" content="@mike_korshunov">
  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2016-05-31T16:48:00+00:00">
  
    <link rel="next" href="https://xrdocs.io/application-hosting/tutorials/2016-06-06-xr-toolbox-app-development-topology" title="XR Toolbox, Part 3 : App Development Topology ">
  
  
    <link rel="prev" href="https://xrdocs.io/application-hosting/tutorials/iosxr-vagrant-bootstrap-config" title="XR Toolbox, Part 2 : Bootstrap XR configuration with Vagrant">
  



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "https://xrdocs.io/application-hosting",
      "logo": "https://xrdocs.io/application-hosting/images/app-hosting-xrdocs.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "Cisco Systems Inc",
      "url" : "https://xrdocs.io/application-hosting",
      "sameAs" : ["https://twitter.com/xrdocs"]
    }
  </script>






<!-- end SEO -->

<link href="https://xrdocs.io/application-hosting/feed.xml" type="application/atom+xml" rel="alternate" title="IOS XR Application Hosting @xrdocs Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="google-site-verification" content="jgRKKm6B9FwJJPXxpmc0-EP3D0Mh8JHXaJqoYIGj1ek" />

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<script>
if (!(window.location.host.startsWith("127.0.0.1") || window.location.host.startsWith("localhost")) && (window.location.host.substr(-3) == '.io') && (window.location.protocol != "https:"))
    window.location.protocol = "https";
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/application-hosting/assets/css/main.css">
<meta http-equiv="cleartype" content="on">
<style>
.underline-on-hover:hover {
    text-decoration: underline;
}
.searchForm{
      border-radius:5px;
      -moz-border-radius:5px;
      -webkit-border-radius:5px;
      width: 900px;
   }
#search_results{
      display: table; margin:0 auto;
   }
</style>
</style>

    

<!-- start custom head snippets -->

<link href="https://xrdocs.io/application-hosting/assets/css/lity.min.css" rel="stylesheet">
<link href="https://xrdocs.io/application-hosting/assets/css/cisco-sans.min.css" rel="stylesheet">
<link href="https://xrdocs.io/application-hosting/assets/css/material-scrolltop.css" rel="stylesheet">

<link rel="apple-touch-icon-precomposed" sizes="57x57" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-57x57.png" />
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-114x114.png" />
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-72x72.png" />
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-144x144.png" />
<link rel="apple-touch-icon-precomposed" sizes="60x60" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-60x60.png" />
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://xrdocs.io/application-hosting/images/apple-touch-icon-152x152.png" />
<link rel="icon" type="image/png" href="https://xrdocs.io/application-hosting/images/favicon-196x196.png" sizes="196x196" />
<link rel="icon" type="image/png" href="https://xrdocs.io/application-hosting/images/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/png" href="https://xrdocs.io/application-hosting/images/favicon-32x32.png" sizes="32x32" />
<link rel="icon" type="image/png" href="https://xrdocs.io/application-hosting/images/favicon-16x16.png" sizes="16x16" />
<link rel="icon" type="image/png" href="https://xrdocs.io/application-hosting/images/favicon-128.png" sizes="128x128" />
<link rel="shortcut icon" href="https://xrdocs.io/application-hosting/images/favicon_cisco.ico" />
<meta name="application-name" content="&nbsp;"/>
<meta name="msapplication-TileColor" content="#FFFFFF" />
<meta name="msapplication-TileImage" content="https://xrdocs.io/application-hosting/images/mstile-144x144.png" />
<meta name="msapplication-square70x70logo" content="https://xrdocs.io/application-hosting/images/mstile-70x70.png" />
<meta name="msapplication-square150x150logo" content="https://xrdocs.io/application-hosting/images/mstile-150x150.png" />
<meta name="msapplication-wide310x150logo" content="https://xrdocs.io/application-hosting/images/mstile-310x150.png" />
<meta name="msapplication-square310x310logo" content="https://xrdocs.io/application-hosting/images/mstile-310x310.png" />


<!-- end custom head snippets -->

  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu" style="padding-left:2em;">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <img src="https://xrdocs.io/application-hosting/images/xrdocs_logo.png" width="45px" height="45px" alt="xrdocs logo" style="float:left;">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="https://xrdocs.io">@xrdocs</a></li>
          <li class="masthead__menu-item"><a href="https://xrdocs.io/application-hosting/">App-Hosting</a></li>
          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.io/application-hosting/blogs/">Blogs</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item greedy-nav-active"><a href="https://xrdocs.io/application-hosting/tutorials/">Tutorials</a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.io/application-hosting/search">Search <i class="fa fa-search" aria-hidden="true"></i></a></li>
                
            


          
            
            
                
                    <li class="masthead__menu-item"><a href="https://xrdocs.io/application-hosting/tags/">Tags</a></li>
                
            


          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    



<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="https://xrdocs.io/application-hosting/images/avatars/Mike_pic.jpg" class="author__avatar" alt="Mike Korshunov">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Mike Korshunov</h3>
    <p class="author__bio">Technical Marketing Engineer, Cisco</p>
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
      
      
        <li><a href="mailto:mkorshun@cisco.com"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
      
      
      
        <li><a href="http://twitter.com/mike_korshunov"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
        <li><a href="http://linkedin.com/in/mkorshunov"><i class="fa fa-fw fa-linkedin-square" aria-hidden="true"></i> LinkedIn</a></li>
      
      
      
      
      
      
        <li><a href="http://github.com/maikor"><i class="fa fa-fw fa-github" aria-hidden="true"></i> Github</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>


  </div>
    <br><button class="btn"><a href="//pdfcrowd.com/url_to_pdf/" style="color:white">Save as PDF</a></button>

</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Using Ansible with IOS-XR 6.1.1">
    <meta itemprop="description" content="Getting started with IOSXR and Ansible playbooks">
    <meta itemprop="datePublished" content="May 31, 2016">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">Using Ansible with IOS-XR 6.1.1
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  5 minutes read
</p>
          
        </header>
      

    
      
        





<div class="breadcrumbs">
  <ol itemscope itemtype="http://schema.org/BreadcrumbList" style="margin:0;padding:0;">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" style="margin:0;padding:0;">
          <a href="https://xrdocs.io/application-hosting/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1" />
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" style="margin:0;padding:0;">
          <a href="https://xrdocs.io/application-hosting/tutorials" itemprop="item"><span itemprop="name">Tutorials</span></a>
          <meta itemprop="position" content="2" />
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current" style="margin:0;padding:0;">Using Ansible with IOS-XR 6.1.1</li>
      
    
  </ol>
</div>

      
    

      <section class="page__content" itemprop="text">
        <aside class="sidebar__right">
<nav class="toc">
    <header><h4 class="nav__title"><i class="fa fa-table"></i> IOS-XR: Ansible and Vagrant</h4></header>
<ul class="toc__menu" id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a>    <ul>
      <li><a href="#vagrant-pre-setup" id="markdown-toc-vagrant-pre-setup">Vagrant pre-setup</a></li>
      <li><a href="#devbox-box-pre-configuration" id="markdown-toc-devbox-box-pre-configuration">devbox box pre-configuration</a></li>
      <li><a href="#ios-xrv-box-pre-configuration" id="markdown-toc-ios-xrv-box-pre-configuration">IOS-XRv box pre-configuration</a></li>
      <li><a href="#configure-passwordless-access-into-xr-linux-shell" id="markdown-toc-configure-passwordless-access-into-xr-linux-shell">Configure Passwordless Access into XR Linux shell</a></li>
      <li><a href="#configure-passwordless-access-into-xr-cli" id="markdown-toc-configure-passwordless-access-into-xr-cli">Configure Passwordless Access into XR CLI</a></li>
    </ul>
  </li>
  <li><a href="#using-ansible-playbooks" id="markdown-toc-using-ansible-playbooks">Using Ansible Playbooks</a>    <ul>
      <li><a href="#ansible-pre-requisites" id="markdown-toc-ansible-pre-requisites">Ansible Pre-requisites</a></li>
      <li><a href="#running-playbooks" id="markdown-toc-running-playbooks">Running Playbooks</a></li>
    </ul>
  </li>
</ul>

  </nav>
</aside>

<h2 id="introduction">Introduction</h2>
<p class="notice--info">The goal of this tutorial is to set up an environment that is identical for Windows, Linux or Mac-OSX users. <br />
So instead of setting up Ansible directly on the User’s Desktop/Host, we simply spin up an Ubuntu vagrant instance to host our Ansible playbooks and environment. Let’s call it <strong>devbox</strong>. We’ll do a separate tutorial on using Ansible directly on Mac-OSX/Windows.</p>

<h2 id="prerequisites">Prerequisites</h2>
<ul>
  <li>Computer with 4-5GB free RAM;</li>
  <li>Vagrant;</li>
  <li>Ansible;</li>
  <li>IOS-XRv Vagrant Box</li>
  <li><a href="https://github.com/ios-xr/vagrant-xrdocs/tree/master/ansible-tutorials">Vagrantfile and scripts for provisioning</a></li>
</ul>

<blockquote>

  <p><strong>IOS-XR Vagrant is currently in Private Beta</strong></p>

  <p>We explain the steps to in the section below:</p>
</blockquote>

<h3 id="vagrant-pre-setup">Vagrant pre-setup</h3>

<p>Clone the repo with Vagrantfile and assisting files:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/ios-xr/vagrant-xrdocs.git
<span class="nv">$ </span><span class="nb">cd </span>vagrant-xrdocs/ansible-tutorials/
<span class="nv">$ </span><span class="nb">ls
</span>ubuntu.sh<span class="k">*</span>  Vagrantfile  xr-config
</code></pre></div></div>

<p>Setup was tested on Windows, but the workflow is the same for other environments. To add an IOS-XR box, you must first download it.</p>

<blockquote class="notice--danger">

  <p><strong>IOS-XR Vagrant is currently in Private Beta</strong></p>

  <p>To download the box, you will need an <strong>API-KEY</strong> and a <strong>CCO-ID</strong></p>

  <p>To get the API-KEY and a CCO-ID, browse to the following link and follow the steps:</p>

  <p><a href="https://xrdocs.io/getting-started/steps-download-iosxr-vagrant">Steps to Generate API-KEY</a></p>
</blockquote>

<div class="highlighter-rouge">
<pre class="highlight">
<code>
$ BOXURL="http://devhub.cisco.com/artifactory/appdevci-release/XRv64/latest/iosxrv-fullk9-x64.box"

$ curl <b><mark>-u your-cco-id:API-KEY</mark></b> $BOXURL --output ~/iosxrv-fullk9-x64.box

$ vagrant box add --name IOS-XRv ~/iosxrv-fullk9-x64.box
</code>
</pre>
</div>

<p class="notice--danger">Of course, you should replace  your-cco-id with your actual Cisco.com ID and API-KEY with the key you generated and copied using the above <a href="https://xrdocs.io/getting-started/steps-download-iosxr-vagrant">link</a>.</p>

<p>Image for devbox will be downloaded from official source:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant box add ubuntu/trusty64
</code></pre></div></div>
<p>We should now have both the boxes available, Use the <code class="highlighter-rouge">vagrant box list</code> command to display the current set of boxes on your system as shown below:</p>

<p class="notice"><img src="https://xrdocs.github.io/xrdocs-images/assets/tutorial-images/xr-ansible-tutorial/xr_ansible_01_box_list.png" alt="Box validation" class="align-center" /></p>

<p>The Vagrantfile contains 2 Vagrant boxes and looks like:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">inline: </span><span class="s2">"echo Hello User"</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"devbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">devbox</span><span class="o">|</span>
    <span class="n">devbox</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"ubuntu/trusty64"</span>
    <span class="n">devbox</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"link1"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"10.1.1.10"</span>
    <span class="n">devbox</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"ubuntu.sh"</span><span class="p">,</span> <span class="ss">privileged: </span><span class="kp">false</span>
  <span class="k">end</span>

  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"xr"</span> <span class="k">do</span> <span class="o">|</span><span class="n">xr</span><span class="o">|</span>
    <span class="n">xr</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"xrv64"</span>
    <span class="n">xr</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="ss">:private_network</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"link1"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"10.1.1.20"</span>
  <span class="k">end</span>
   
<span class="k">end</span>

</code></pre></div></div>

<p>Now we are ready to boot up the boxes:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkorshun@MKORSHUN-2JPYH MINGW64 ~/Documents/workCisco/tutorial
<span class="nv">$ </span><span class="nb">ls
</span>ubuntu.sh<span class="k">*</span>  Vagrantfile  xr-config

mkorshun@MKORSHUN-2JPYH MINGW64 ~/Documents/workCisco/tutorial
<span class="nv">$ </span>vagrant up
</code></pre></div></div>

<h3 id="devbox-box-pre-configuration">devbox box pre-configuration</h3>

<p>To access the devbox box just issue the command (no password required):</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant ssh devbox
</code></pre></div></div>

<p class="notice--warning">The devbox instance is already configured via file <a href="https://github.com/Maikor/IOSXR-Ansible-tutorial/blob/master/ubuntu.sh">“ubuntu.sh”</a>. This section is only for the user’s information.</p>

<blockquote class="notice--info">

  <p>Let’s review the content of the script <a href="https://github.com/Maikor/IOSXR-Ansible-tutorial/blob/master/ubuntu.sh">“ubuntu.sh”</a><br />
The first four lines are responsible for downloading required packages for Ansible and updating the system.</p>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get install <span class="nt">-y</span> python-setuptools python-dev build-essential git libssl-dev libffi-dev sshpass
<span class="nb">sudo </span>easy_install pip 
wget https://bootstrap.pypa.io/ez_setup.py <span class="nt">-O</span> - | <span class="nb">sudo </span>python
</code></pre></div>  </div>

  <p>Next, the script clones the  Ansible and the  IOSXR-Ansible repos:</p>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/ios-xr/iosxr-ansible.git
git clone git://github.com/ansible/ansible.git <span class="nt">--recursive</span>
</code></pre></div>  </div>

  <p>It then installs Ansible and applies the variables from “ansible_env” to the system.</p>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>ansible/ <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>python setup.py install
<span class="nb">echo</span> <span class="s2">"source /home/vagrant/iosxr-ansible/remote/ansible_env"</span> <span class="o">&gt;&gt;</span> /home/vagrant/.profile
</code></pre></div>  </div>

  <p>The last section is responsible for generating a public key for paswordless authorization (for XR linux) and a base 64 version of it (for XR CLI):</p>

  <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen <span class="nt">-t</span> rsa <span class="nt">-f</span> /home/vagrant/.ssh/id_rsa <span class="nt">-q</span> <span class="nt">-P</span> <span class="s2">""</span>
cut <span class="nt">-d</span><span class="s2">" "</span> <span class="nt">-f2</span> ~/.ssh/id_rsa.pub | base64 <span class="nt">-d</span> <span class="o">&gt;</span> ~/.ssh/id_rsa_pub.b64
</code></pre></div>  </div>
</blockquote>

<h3 id="ios-xrv-box-pre-configuration">IOS-XRv box pre-configuration</h3>

<p>To access XR Linux Shell:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant ssh rtr
</code></pre></div></div>

<p>To access XR console it takes one additional step to figure out port (credentials for ssh: vagrant/vagrant):</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkorshun@MKORSHUN-2JPYH MINGW64 ~/Documents/workCisco/tutorial
<span class="nv">$ </span>vagrant port rtr
The forwarded ports <span class="k">for </span>the machine are listed below. Please note that
these values may differ from values configured <span class="k">in </span>the Vagrantfile <span class="k">if </span>the
provider supports automatic port collision detection and resolution.
 22 <span class="o">(</span>guest<span class="o">)</span> <span class="o">=</span> 2223 <span class="o">(</span>host<span class="o">)</span>
 57722 <span class="o">(</span>guest<span class="o">)</span> <span class="o">=</span> 2200 <span class="o">(</span>host<span class="o">)</span>  
 
mkorshun@MKORSHUN-2JPYH MINGW64 ~/Documents/workCisco/tutorial
<span class="nv">$ </span>ssh <span class="nt">-p</span> 2223 vagrant@localhost
vagrant@localhost<span class="s1">'s password:
RP/0/RP0/CPU0:ios#
</span></code></pre></div></div>

<p>Now, let’s configure an IP address on the IOS-XRv instance. Issue the following command on XR cli:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conf t
hostname xr
interface GigabitEthernet0/0/0/0
 ipv4 address 10.1.1.20 255.255.255.0
 no shutdown
!
commit
end
</code></pre></div></div>

<p>Checking connectivity between boxes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RP/0/RP0/CPU0:ios#ping 10.1.1.10
Mon May  9 08:36:33.071 UTC
Type escape sequence to abort.
Sending 5, 100-byte ICMP Echos to 10.1.1.10, timeout is 2 seconds:
!!!!!
Success rate is 100 percent (5/5), round-trip min/avg/max = 1/5/20 ms
RP/0/RP0/CPU0:ios#
</code></pre></div></div>

<h3 id="configure-passwordless-access-into-xr-linux-shell">Configure Passwordless Access into XR Linux shell</h3>
<p>Let’s copy public part of key from <strong>devbox</strong> box and allow access without password. 
First,  connect to the devbox instance and copy file to XR via SCP:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant ssh devbox  

scp <span class="nt">-P</span> 57722 /home/vagrant/.ssh/id_rsa.pub  vagrant@10.1.1.20:/home/vagrant/id_rsa_ubuntu.pub
</code></pre></div></div>

<p>Now add the copied keys to authorized_keys in XR linux</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant ssh rtr  

<span class="nb">cat</span> /home/vagrant/id_rsa_ubuntu.pub <span class="o">&gt;&gt;</span> /home/vagrant/.ssh/authorized_keys
</code></pre></div></div>

<h3 id="configure-passwordless-access-into-xr-cli">Configure Passwordless Access into XR CLI</h3>
<p>If we want passwordless SSH from devbox to XR CLI, issue the following commands in XR CLI:</p>

<p>The first command uses scp to copy the public key (base 64 encoded) to XR. <br />
Once we have the key locally, we import it using XR CLI’s <code class="highlighter-rouge">crypto key import</code> command.</p>

<p class="text-center notice--warning"><strong>Execute in XR CLI</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>scp vagrant@10.1.1.10:/home/vagrant/.ssh/id_rsa_pub.b64 /disk0:/id_rsa_pub.b64

crypto key import authentication rsa disk0:/id_rsa_pub.b64
</code></pre></div></div>

<p>File “id_rsa_pub.b64” was created by provisioning script “Ubuntu.sh”, during Vagrant provisioning.</p>

<h2 id="using-ansible-playbooks">Using Ansible Playbooks</h2>

<h3 id="ansible-pre-requisites">Ansible Pre-requisites</h3>

<p>On the devbox box let’s configure Ansible prerequisites. 
We need to configure 2 files:</p>

<ol>
  <li>
    <p>File “ansible_hosts”:  It contains the ip address of the XR instance.
We also specify a user to connect to the machine: “ansible_ssh_user=vagrant”</p>
  </li>
  <li>
    <p>File “ansible_env”: Used to set up the environment for Ansible.</p>
  </li>
</ol>

<p>We do not delve into <a href="https://github.com/CiscoDevNet/ydk-py-samples">YDK</a> for now, it’s a topic for another tutorial. Note that the files ansible_hosts and ansible_env are preconfigured for our needs.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>iosxr-ansible/
<span class="nb">cd </span>remote/

vagrant@vagrant-ubuntu-trusty-64:~/iosxr-ansible/remote<span class="nv">$ </span><span class="nb">cat </span>ansible_hosts
<span class="o">[</span>ss-xr]
10.1.1.20 <span class="nv">ansible_ssh_user</span><span class="o">=</span>vagrant

vagrant@vagrant-ubuntu-trusty-64:~/iosxr-ansible/remote<span class="nv">$ </span><span class="nb">cat </span>ansible_env
<span class="nb">export </span><span class="nv">BASEDIR</span><span class="o">=</span>/home/vagrant
<span class="nb">export </span><span class="nv">IOSXRDIR</span><span class="o">=</span><span class="nv">$BASEDIR</span>/iosxr-ansible
<span class="nb">export </span><span class="nv">ANSIBLE_HOME</span><span class="o">=</span><span class="nv">$BASEDIR</span>/ansible
<span class="nb">export </span><span class="nv">ANSIBLE_INVENTORY</span><span class="o">=</span><span class="nv">$IOSXRDIR</span>/remote/ansible_hosts
<span class="nb">export </span><span class="nv">ANSIBLE_LIBRARY</span><span class="o">=</span><span class="nv">$IOSXRDIR</span>/remote/library
<span class="nb">export </span><span class="nv">ANSIBLE_CONFIG</span><span class="o">=</span><span class="nv">$IOSXRDIR</span>/remote/ansible_cfg
<span class="nb">export </span><span class="nv">YDK_DIR</span><span class="o">=</span><span class="nv">$BASEDIR</span>/ydk/ydk-py
<span class="nb">export </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$YDK_DIR</span>

</code></pre></div></div>

<h3 id="running-playbooks">Running Playbooks</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/iosxr-ansible/remote/  

ansible-playbook samples/iosxr_get_facts.yml   

ansible-playbook iosxr_cli.yml <span class="nt">-e</span> <span class="s1">'cmd="show interface brief"'</span> 
</code></pre></div></div>

<p>Usual playbook would look like:</p>

<p class="notice"><img src="https://xrdocs.github.io/xrdocs-images/assets/tutorial-images/xr-ansible-tutorial/ansible_tutorial_cat_playbook.png" alt="Playbook content" class="align-center" /></p>

<p>Output from our XR instance:</p>

<p class="notice"><img src="https://xrdocs.github.io/xrdocs-images/assets/tutorial-images/xr-ansible-tutorial/ansible_tutorial_run_playbook.png" alt="Playbook result" class="align-center" /></p>

<p class="notice--success">Samples folder contains various playbooks, files started with “show_” using iosxr_cli playbook and passing cmd to XR as parameter. To run playbook as “vagrant” user, playbook should contain string: “become: yes”
Feel free to play with any playbook!</p>

        
      </section>

      <footer class="page__meta">
        
        




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="https://xrdocs.io/application-hosting/tags/#ansible" class="page__taxonomy-item" rel="tag">Ansible</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.io/application-hosting/tags/#cisco" class="page__taxonomy-item" rel="tag">cisco</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.io/application-hosting/tags/#iosxr" class="page__taxonomy-item" rel="tag">iosxr</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.io/application-hosting/tags/#linux" class="page__taxonomy-item" rel="tag">linux</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.io/application-hosting/tags/#vagrant" class="page__taxonomy-item" rel="tag">vagrant</a><span class="sep">, </span>
    
      
      
      <a href="https://xrdocs.io/application-hosting/tags/#xr-toolbox" class="page__taxonomy-item" rel="tag">xr toolbox</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-05-31T16:48:00+00:00">May 31, 2016</time></p>
        
        

      </footer>

      

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=https://xrdocs.io/application-hosting/tutorials/IOSXR-Ansible" class="btn btn--twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https://xrdocs.io/application-hosting/tutorials/IOSXR-Ansible" class="btn btn--facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=https://xrdocs.io/application-hosting/tutorials/IOSXR-Ansible" class="btn btn--google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https://xrdocs.io/application-hosting/tutorials/IOSXR-Ansible" class="btn btn--linkedin" title="Share on LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>

    <br>
    <br>
    <br>
</section>


    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title">Leave a Comment</h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
</div>


    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
      <li><a href="https://twitter.com/xrdocs"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
      <li><a href="http://github.com/xrdocs"><i class="fa fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
    
    
    <li><a href="https://xrdocs.io/application-hosting/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">This site is maintained by Cisco Systems, Inc. employees. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    <script src="https://xrdocs.io/application-hosting/assets/js/main.min.js"></script>
<script src="https://xrdocs.io/application-hosting/assets/js/scrollmenu.js"></script>




  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-78256516-1', 'auto');
  ga('send', 'pageview');
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'xrdocs';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






<!-- material-scrolltop button -->
<button class="material-scrolltop" type="button"></button>

<!-- material-scrolltop plugin -->
<script src="https://xrdocs.io/application-hosting/assets/js/material-scrolltop.js"></script>

<!-- Initialize material-scrolltop with (minimal) -->
<script>
    $('body').materialScrollTop();
</script>


  </body>
</html>

